# Generated by helmfile2compose â€” do not edit manually
name: stoat
services:
  livekit-livekit-server:
    restart: always
    image: livekit/livekit-server:v1.9.0
    command:
    - --disable-strict-config
    environment:
      LIVEKIT_CONFIG: "keys:\n  43e2a23b5f91: 4823d8b08d6d1db95d8d61f6b304e71294e2576234fef9a760\n\
        log_level: info\nport: 7880\nredis:\n  address: redis-master:6379\n  password:\
        \ d99c08fa858d5790387974bbf6cb246aa751b39a4894d7c986\nrtc:\n  port_range_end:\
        \ 50100\n  port_range_start: 50000\n  tcp_port: 7881\n  use_external_ip: false\n\
        turn:\n  enabled: false\n  loadBalancerAnnotations: {}\n"
    ports:
    - 7881:7881/tcp
    - 50000-50100:50000-50100/udp
  minio:
    restart: always
    image: quay.io/minio/minio:RELEASE.2024-12-18T13-15-44Z
    entrypoint:
    - /bin/sh
    - -ce
    - /usr/bin/docker-entrypoint.sh minio server /export -S /etc/minio/certs/ --address
      :9000 --console-address :9001
    environment:
      MINIO_ROOT_USER: f0446cefd2bbe50a6ccd00183f143a0cb4ec73974238e890e8
      MINIO_ROOT_PASSWORD: a67cbd8e6b0278b5decdab786008bc1154ac5ca8ca415a8ff2
      MINIO_PROMETHEUS_AUTH_TYPE: public
    volumes:
    - ./secrets/minio:/tmp/credentials:ro
    - /home/docker/stoat/minio:/export
  stoatchat-api:
    restart: always
    image: ghcr.io/stoatchat/api:v0.11.0
    volumes:
    - ./configmaps/revolt-toml/Revolt.toml:/Revolt.toml:ro
  stoatchat-client:
    restart: always
    image: baptisterajaut/stoatchat-web:dev
    environment:
      REVOLT_PUBLIC_URL: https://sussy.chat/api
  stoatchat-crond:
    restart: always
    image: ghcr.io/stoatchat/crond:v0.11.0
    volumes:
    - ./configmaps/revolt-toml/Revolt.toml:/Revolt.toml:ro
  stoatchat-events:
    restart: always
    image: ghcr.io/stoatchat/events:v0.11.0
    volumes:
    - ./configmaps/revolt-toml/Revolt.toml:/Revolt.toml:ro
  stoatchat-file-server:
    restart: always
    image: ghcr.io/stoatchat/file-server:v0.11.0
    volumes:
    - ./configmaps/revolt-toml/Revolt.toml:/Revolt.toml:ro
  stoatchat-mongodb-init-log-dir:
    restart: on-failure
    image: docker.io/bitnami/mongodb:latest
    entrypoint:
    - /bin/bash
    command:
    - -ec
    - 'ln -sf /dev/stdout "/opt/bitnami/mongodb/logs/mongodb.log"

      '
    volumes:
    - /opt/bitnami/mongodb/logs
  stoatchat-mongodb:
    restart: always
    image: docker.io/bitnami/mongodb:latest
    environment:
      BITNAMI_DEBUG: 'false'
      MONGODB_EXTRA_USERNAMES: stoatchat
      MONGODB_EXTRA_DATABASES: revolt
      MONGODB_EXTRA_PASSWORDS: 7ae0130d55a54fdeac4a47b6aa9e0597fdf3e869e15090da10
      MONGODB_ROOT_USER: root
      MONGODB_ROOT_PASSWORD: 0980f79070d146de3c81278beb3eb8814c6d1db7bfc4494bbc
      ALLOW_EMPTY_PASSWORD: 'no'
      MONGODB_SYSTEM_LOG_VERBOSITY: '0'
      MONGODB_DISABLE_SYSTEM_LOG: 'no'
      MONGODB_DISABLE_JAVASCRIPT: 'no'
      MONGODB_ENABLE_JOURNAL: 'yes'
      MONGODB_PORT_NUMBER: '27017'
      MONGODB_ENABLE_IPV6: 'no'
      MONGODB_ENABLE_DIRECTORY_PER_DB: 'no'
    volumes:
    - /tmp
    - /opt/bitnami/mongodb/conf
    - /opt/bitnami/mongodb/tmp
    - /opt/bitnami/mongodb/logs
    - /.mongodb
    - /home/docker/stoat/mongodb:/bitnami/mongodb
    - ./configmaps/stoatchat-mongodb-common-scripts:/bitnami/scripts:ro
  stoatchat-proxy:
    restart: always
    image: ghcr.io/stoatchat/proxy:v0.11.0
    volumes:
    - ./configmaps/revolt-toml/Revolt.toml:/Revolt.toml:ro
  stoatchat-pushd:
    restart: always
    image: ghcr.io/stoatchat/pushd:v0.11.0
    volumes:
    - ./configmaps/revolt-toml/Revolt.toml:/Revolt.toml:ro
  stoatchat-rabbitmq:
    restart: always
    image: rabbitmq:4-management
    environment:
      RABBITMQ_DEFAULT_PASS: fd9e6b49bc17eea8e09204247b9783cc69401e0d71e287e0dc
      RABBITMQ_DEFAULT_USER: stoatchat
    volumes:
    - /home/docker/stoat/rabbitmq:/var/lib/rabbitmq
  stoatchat-voice-ingress:
    restart: always
    image: ghcr.io/stoatchat/voice-ingress:v0.11.0
    volumes:
    - ./configmaps/revolt-toml/Revolt.toml:/Revolt.toml:ro
  redis-master:
    restart: always
    image: redis:7-alpine
    command:
    - redis-server
    - --requirepass
    - d99c08fa858d5790387974bbf6cb246aa751b39a4894d7c986
    volumes:
    - /home/docker/stoat/redis:/data
  caddy:
    image: caddy:2-alpine
    restart: always
    ports:
    - 80:80
    - 443:443
    volumes:
    - ./Caddyfile:/etc/caddy/Caddyfile:ro
    - /home/docker/stoat/caddy:/data
    - /home/docker/stoat/caddy-config:/config
  fix-permissions:
    image: busybox
    restart: 'no'
    user: '0'
    command:
    - sh
    - -c
    - chown -R 1000 /fixperm/0 && chown -R 1001 /fixperm/1 /fixperm/2
    volumes:
    - /home/docker/stoat/minio:/fixperm/0
    - /home/docker/stoat/redis-data:/fixperm/1
    - /home/docker/stoat/mongodb:/fixperm/2
  minio-init:
    image: quay.io/minio/mc:RELEASE.2024-11-21T17-21-54Z
    restart: on-failure
    entrypoint:
    - /bin/sh
    - -c
    command:
    - mc alias set local http://minio:9000 f0446cefd2bbe50a6ccd00183f143a0cb4ec73974238e890e8
      a67cbd8e6b0278b5decdab786008bc1154ac5ca8ca415a8ff2 && mc mb --ignore-existing
      local/revolt-uploads
